# ๐ ุฑุงูููุง ุชูุธู ู ุชูููฺฏ **setenv.sh** ู **server.xml** ุฏุฑ Tomcat

ุฏุฑ ุงู ูุณุฎูุ ููุท ุฑู ุฏู ุจุฎุด ุงุตู ุชูุฑฺฉุฒ ูโฺฉูู:

- **ูุงู setenv.sh (ุชูุธู JVM)**
- **ูุงู server.xml (ThreadPool + Connector)**

ููฺูู ุฑูุด **ูุญุงุณุจูู ุตุญุญ ู ุนูู ูพุงุฑุงูุชุฑูุง ุชูููฺฏ** ุฑุง ุชูุถุญ ูโุฏูู.

---

# 1) โ๏ธ ุชูุธูุงุช server.xml (ThreadPool + Connector)

ุงู ุชูุธูุงุช ุฏุงุฎู ูุงู ุฒุฑ ูุฑุงุฑ ูโฺฏุฑุฏ:

```
/opt/tomcat/conf/server.xml
```

### ๐ ฺฉุงููฺฏ ููุง

```xml
<!-- ================== katin optimized ================== -->
<Executor name="tomcatThreadPool"
          namePrefix="catalina-exec-"
          maxThreads="400"
          minSpareThreads="50" />

<Connector executor="tomcatThreadPool"
           port="8080"
           protocol="HTTP/1.1"
           connectionTimeout="20000"
           acceptCount="200"
           redirectPort="8443"
           relaxedPathChars="[]|"
           relaxedQueryChars="[]|{}^" />
<!-- ================= end katin optimized ================ -->
```

---

## ๐งฎ ุฑูุด ูุญุงุณุจู ููุฏุงุฑ ุตุญุญ maxThreads ู acceptCount

### ๐ **ฑ) ูุญุงุณุจู maxThreads ุจุฑุงุณุงุณ ุชุนุฏุงุฏ CPU**

ูุฑููู ุงุณุชุงูุฏุงุฑุฏ JVM:

```
maxThreads = CPU cores ร 25
```

ุจุฑุง ุณุฑูุฑ ุดูุง:

```
16 core ร 25 = 400   โ ููุฏุงุฑ ฺฉุงููุงู ุตุญุญ
```

### ๐ **ฒ) ูุญุงุณุจู acceptCount**

ุงู ูพุงุฑุงูุชุฑ ุตู ุฏุฑุฎูุงุณุชโูุง ุงุณุช ฺฉู ููุชุธุฑ thread ูุณุชูุฏ.

ูุฑููู ูพุดููุงุฏ:

```
acceptCount = maxThreads ร 0.5
```

ุดูุง:

```
400 ร 0.5 = 200  โ ููุฏุงุฑ ุฏุฑุณุช
```

ูพุณ ููุฏุงุฑูุง ูุนู ุฏููุงู ุฏุฑุณุช ุงูุชุฎุงุจ ุดุฏูโุงูุฏ.

---

# 2) โ๏ธ ุชูุธูุงุช setenv.sh (JVM Tuning)

๐ ูุณุฑ:

```
/opt/tomcat/bin/setenv.sh
```

### ๐ ฺฉุงููฺฏ ููุง

```bash
export CATALINA_OPTS="\
-Xms4g \
-Xmx12g \
-XX:+UseG1GC \
-XX:MaxGCPauseMillis=200 \
-XX:MaxMetaspaceSize=512m \
-Djava.security.egd=file:/dev/./urandom \
"
```

---

## ๐งฎ ุฑูุด ูุญุงุณุจู Xms ู Xmx

### ๐ **ฑ) ฺฉู RAM ุณุฑูุฑ = 16GB**

ุจุงุฏ ุจู ุตูุฑุช ุฒุฑ ุชูุณู ุดูุฏ:

- **ทฐูช ุจุฑุง JVM**
- **ณฐูช ุจุฑุง OS + Tomcat threads + buffers**

### ูุญุงุณุจู:

```
16GB ร 0.70 = 11.2GB  โ 12GB (Xmx)
```

### ฺุฑุง Xms=4GBุ

Xms ุจุงุฏ **ุซุงุจุช ูู ฺฉูุชุฑ ุงุฒ Xmx** ุจุงุดุฏ ุชุง JVM ุณุฑุนโุชุฑ ุจุงูุง ุจุงุฏ.

ูุฑููู:

```
Xms = Xmx ร 0.3
4GB = 12GB ร 0.33
```

ฺฉุงููุงู ุตุญุญ ุงุณุช.

---

## ๐งฎ ุฑูุด ูุญุงุณุจู Metaspace

ุงฺฏุฑ ุงูพ ุจุฒุฑฺฏ ูุณุช:

```
256m ฺฉุงู ุงุณุช
```

ุงฺฏุฑ ุงูพ Enterprise ุจุงุดุฏ:

```
512m ุจูุชุฑู ุงูุชุฎุงุจ ุงุณุช
```

ุดูุง ฺูู ุงูพ ุจุฒุฑฺฏ ุฏุงุฑุฏ โ 512m ุฏุฑุณุช ุงุณุช.

---

## ๐งฎ ุฏูู ุงูุชุฎุงุจ G1GC

ุจุฑุง ุณุฑูุฑูุง ฺูุฏโูุณุชูโุง (ุจุด ุงุฒ 8 core) ููุดู ุจูุชุฑ ุงุณุช:

```
UseG1GC
```

ูุฒุงุง:

- pause ุจุณุงุฑ ฺฉู
- ููุงุณุจ ุณุฑูุณโูุง ุขููุงู
- ุจูุชุฑู GC ุจุฑุง ุณุฑูุฑูุง 16 core

---

# ๐ฏ ูุชุฌู ููุง ุชูููฺฏ

ุจุฑุงุณุงุณ ููุงุจุน ุณุฑูุฑุช:

- **maxThreads=400** โ ฺฉุงููุงู ุฏุฑุณุช
- **acceptCount=200** โ ูุทุงุจู ูุฑููู
- **Xmx=12GB** โ ุจูุชุฑู ููุฏุงุฑ ุจุฑุง 16GB RAM
- **Xms=4GB** โ ููุฏุงุฑ ุงุณุชุงูุฏุงุฑุฏ startup
- **G1GC** โ ุงูุชุฎุงุจ ุญุฑููโุง
- **Metaspace=512m** โ ููุงุณุจ ุงูพูฺฉุดู ุญุฌู

ุงู ูุญุงุณุจุงุช ู ุชูุธูุงุช ุจุงุนุซ ุดุฏ Tomcat ุจุชูุงูุฏ:

- **ณทตฐ ุฑฺฉูุฆุณุช/ุซุงูู ุฑู localhost**
- **ฑนทท ุฑฺฉูุฆุณุช/ุซุงูู ุฑู ุดุจฺฉู ูุงูุน**
  ุฑุง ุจุฏูู ูฺ ุฎุทุง ูุฏุฑุช ฺฉูุฏ.

---
